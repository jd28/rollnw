import core.string as str;
import core.array as array;
from core.test import { reset, test, summary };

fn main() {
    reset();
    test("len empty", str.len("") == 0);
    test("len", str.len("hello") == 5);

    test("substr", str.substr("hello", 1, 3) == "ell");
    test("substr from start", str.substr("hello", 0, 2) == "he");
    test("substr to end", str.substr("hello", 3, 2) == "lo");
    test("substr full", str.substr("hello", 0, 5) == "hello");
    test("substr empty", str.substr("hello", 2, 0) == "");

    test("char_at first", str.char_at("ABC", 0) == 65);
    test("char_at middle", str.char_at("ABC", 1) == 66);
    test("char_at last", str.char_at("ABC", 2) == 67);

    test("find", str.find("hello", "ll") == 2);
    test("find at start", str.find("hello", "he") == 0);
    test("find at end", str.find("hello", "lo") == 3);
    test("find not found", str.find("hello", "x") == -1);
    test("find empty needle", str.find("hello", "") == 0);

    test("contains true", str.contains("hello", "ell"));
    test("contains false", !str.contains("hello", "xyz"));
    test("contains empty", str.contains("hello", ""));

    test("starts_with true", str.starts_with("hello", "hel"));
    test("starts_with false", !str.starts_with("hello", "llo"));
    test("starts_with empty", str.starts_with("hello", ""));
    test("starts_with full", str.starts_with("hello", "hello"));

    test("ends_with true", str.ends_with("hello", "lo"));
    test("ends_with false", !str.ends_with("hello", "hel"));
    test("ends_with empty", str.ends_with("hello", ""));
    test("ends_with full", str.ends_with("hello", "hello"));

    test("to_upper", str.to_upper("hello") == "HELLO");
    test("to_upper mixed", str.to_upper("Hello World") == "HELLO WORLD");
    test("to_upper empty", str.to_upper("") == "");

    test("to_lower", str.to_lower("HELLO") == "hello");
    test("to_lower mixed", str.to_lower("Hello World") == "hello world");
    test("to_lower empty", str.to_lower("") == "");

    test("trim spaces", str.trim("  hi  ") == "hi");
    test("trim tabs", str.trim("\thi\t") == "hi");
    test("trim left only", str.trim("  hi") == "hi");
    test("trim right only", str.trim("hi  ") == "hi");
    test("trim nothing", str.trim("hi") == "hi");
    test("trim empty", str.trim("") == "");

    test("replace single", str.replace("hello", "l", "L") == "heLLo");
    test("replace word", str.replace("hello world", "world", "there") == "hello there");
    test("replace not found", str.replace("hello", "x", "y") == "hello");
    test("replace empty old", str.replace("hello", "", "x") == "hello");

    test("to_int positive", str.to_int("42") == 42);
    test("to_int negative", str.to_int("-123") == -123);
    test("to_int zero", str.to_int("0") == 0);

    test("to_float", str.to_float("3.14") > 3.13);
    test("to_float int", str.to_float("42") > 41.9);

    test("from_char_code A", str.from_char_code(65) == "A");
    test("from_char_code a", str.from_char_code(97) == "a");
    test("from_char_code 0", str.from_char_code(48) == "0");

    var parts = str.split("a,b,c", ",");
    test("split len", array.len(parts) == 3);
    test("split first", array.get(parts, 0) == "a");
    test("split second", array.get(parts, 1) == "b");
    test("split third", array.get(parts, 2) == "c");

    var joined = str.join(parts, "-");
    test("join", joined == "a-b-c");

    var empty_parts = str.split("hello", ",");
    test("split no delim", array.len(empty_parts) == 1);
    test("split no delim value", array.get(empty_parts, 0) == "hello");

    var words: array!(string) = {"hello", "world"};
    array.push(words, "!");
    test("join words", str.join(words, " ") == "hello world !");

    test("append basic", str.append("hello", " world") == "hello world");
    test("append empty suffix", str.append("hello", "") == "hello");
    test("append to empty", str.append("", "world") == "world");
    test("append both empty", str.append("", "") == "");

    test("insert middle", str.insert("hello", 2, "XX") == "heXXllo");
    test("insert start", str.insert("hello", 0, "XX") == "XXhello");
    test("insert end", str.insert("hello", 5, "XX") == "helloXX");
    test("insert empty", str.insert("", 0, "XX") == "XX");
    test("insert negative pos", str.insert("hello", -5, "XX") == "XXhello");
    test("insert past end", str.insert("hello", 100, "XX") == "helloXX");

    test("reverse basic", str.reverse("hello") == "olleh");
    test("reverse empty", str.reverse("") == "");
    test("reverse single", str.reverse("a") == "a");
    test("reverse palindrome", str.reverse("aba") == "aba");

    test("pad_left basic", str.pad_left("42", 5, "0") == "00042");
    test("pad_left default", str.pad_left("hi", 5) == "   hi");
    test("pad_left no change", str.pad_left("hello", 3) == "hello");

    test("pad_right basic", str.pad_right("hi", 5, ".") == "hi...");
    test("pad_right default", str.pad_right("hi", 5) == "hi   ");

    test("last_index_of found", str.last_index_of("hello hello", "hello") == 6);
    test("last_index_of single", str.last_index_of("hello", "l") == 3);
    test("last_index_of not found", str.last_index_of("hello", "x") == -1);

    test("count basic", str.count("hello hello", "hello") == 2);
    test("count single", str.count("hello", "l") == 2);
    test("count not found", str.count("hello", "x") == 0);

    test("trim_start", str.trim_start("  hello") == "hello");
    test("trim_start no change", str.trim_start("hello  ") == "hello  ");

    test("trim_end", str.trim_end("hello  ") == "hello");
    test("trim_end no change", str.trim_end("  hello") == "  hello");

    summary();
}
