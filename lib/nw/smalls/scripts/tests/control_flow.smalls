from core.test import { test, reset, summary };

fn test_if_true(): int {
    if (true) {
        return 1;
    }
    return 0;
}

fn test_if_false(): int {
    if (false) {
        return 1;
    }
    return 0;
}

fn test_if_else_true(): int {
    if (true) {
        return 1;
    } else {
        return 2;
    }
}

fn test_if_else_false(): int {
    if (false) {
        return 1;
    } else {
        return 2;
    }
}

fn test_if_elif_first(): int {
    var x = 7;
    if (x < 5) {
        return 1;
    } elif (x < 10) {
        return 2;
    } else {
        return 3;
    }
}

fn test_if_elif_else_tail(): int {
    var x = 11;
    if (x < 5) {
        return 1;
    } elif (x < 10) {
        return 2;
    } elif (x < 15) {
        return 3;
    } else {
        return 4;
    }
}

fn test_if_elif_fallthrough_else(): int {
    var x = 20;
    if (x < 5) {
        return 1;
    } elif (x < 10) {
        return 2;
    } else {
        return 3;
    }
}

fn test_for_while_style(): int {
    var i = 0;
    for (i < 5) {
        i = i + 1;
    }
    return i;
}

fn test_for_infinite_break(): int {
    var i = 0;
    for {
        i = i + 1;
        if (i == 3) {
            break;
        }
    }
    return i;
}

fn test_for_cstyle_decl(): int {
    var sum = 0;
    for (var i = 0; i < 3; i = i + 1) {
        sum = sum + i;
    }
    return sum;
}

fn test_for_cstyle_expr(): int {
    var i = 0;
    var sum = 0;
    for (i = 0; i < 3; i = i + 1) {
        sum = sum + i;
    }
    return sum;
}

fn test_for_cstyle_missing_parts(): int {
    var i = 0;
    var sum = 0;
    for (; i < 3;) {
        sum = sum + i;
        i = i + 1;
    }
    return sum;
}

fn test_for_continue(): int {
    var sum = 0;
    for (var i = 0; i < 4; i = i + 1) {
        if (i == 2) {
            continue;
        }
        sum = sum + i;
    }
    return sum;
}

fn test_nested_if(): int {
    var x = 10;
    if (x > 5) {
        if (x > 8) {
            return 1;
        } else {
            return 2;
        }
    }
    return 0;
}

fn main() {
    reset();

    test("if_true", test_if_true() == 1);
    test("if_false", test_if_false() == 0);
    test("if_else_true", test_if_else_true() == 1);
    test("if_else_false", test_if_else_false() == 2);
    test("if_elif_first", test_if_elif_first() == 2);
    test("if_elif_else_tail", test_if_elif_else_tail() == 3);
    test("if_elif_fallthrough_else", test_if_elif_fallthrough_else() == 3);
    test("for_while_style", test_for_while_style() == 5);
    test("for_infinite_break", test_for_infinite_break() == 3);
    test("for_cstyle_decl", test_for_cstyle_decl() == 3);
    test("for_cstyle_expr", test_for_cstyle_expr() == 3);
    test("for_cstyle_missing_parts", test_for_cstyle_missing_parts() == 3);
    test("for_continue", test_for_continue() == 4);
    test("nested_if", test_nested_if() == 1);

    summary();
}
